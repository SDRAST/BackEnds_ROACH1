import Radio_Astronomy as RA

def roach_name_adaptor(func):
    """
    If we send the number of the roach instead of the roach name, it will still
    work. This will make it easier for this code to adapt to existing client
    side use cases.
    
    The convention is that the DTO ROACHs, at least, are known by names
    ("roach1", "roach2") or by index numbers (0, 1).
    
    Note that the ROACH name or number must be the first argument.
    """
    def wrapper(self, n, *args):
        template = self.template
        name = n
        if isinstance(n, int):
            if template == 'sao':
                name = "{}64k-{}".format(template, n)
            elif template == 'roach':
                name = "{}{}".format(template, n+1)
        return func(self, name, *args)
    return wrapper

def adc_cnt_mv_scale_factor(atten_gain=None, fe_gain=None):
        """
        Raw ADC count to mV.
  
        Scale factor for calibrating a raw ADC count to millivolts.  The
        millivolts are referred to the National Instruments ADC input
        if no gains are specified.  If atten_gain is specified it refers
        to the input of the attenuator/amplifier combination of the KatADC RF.
        If fe_gain is specified, it refers to the input of the front end.
  
        @param atten_gain : current attenuator gain setting
        @type  atten_gain : float
  
        @param fe_gain : front-end gain
        @type  fe_gain : float
  
        @return: float
        """
        if atten_gain == None:
          return 3.93
        if fe_gain == None:
          return 3.93/RA.dbuv_to_uV(atten_gain_map['katadc'][atten_gain])
        else:
          return 3.93/RA.dbuv_to_uV(atten_gain_map['katadc'][atten_gain] + fe_gain)
  
# atten_gain_map maps the selected attenuator level to actual attenuation.
atten_gain_map = {
  'katadc':{
    -11.50:-11.5, -11.00:-11.0, -10.50:-10.5, -10.00:-10.0, -9.50: -9.5,
     -9.00: -9.0,  -8.50: -8.5,  -8.00: -8.0,  -7.50: -7.5, -7.00: -7.0,
     -6.50: -6.5,  -6.00: -6.0,  -5.50: -5.5,  -5.00: -5.0, -4.50: -4.5,
     -4.00: -4.0,  -3.50: -3.5,  -3.00: -3.0,  -2.50: -2.5, -2.00: -2.0,
     -1.50: -1.5,  -1.00: -1.0,  -0.50: -0.5,   0.00:  0.0,  0.50:  0.5,
      1.00:  1.0,   1.50:  1.5,   2.00:  2.0,   2.50:  2.5,  3.00:  3.0,
      3.50:  3.5,   4.00:  4.0,   4.50:  4.5,   5.00:  5.0,  5.50:  5.5,
      6.00:  6.0,   6.50:  6.5,   7.00:  7.0,   7.50:  7.5,  8.00:  8.0,
      8.50:  8.5,   9.00:  9.0,   9.50:  9.5,  10.00: 10.0, 10.50: 10.5,
     11.00: 11.0,  11.50: 11.5,  12.00: 12.0,  12.50: 12.5, 13.00: 13.0,
     13.50: 13.5,  14.00: 14.0,  14.50: 14.5,  15.00: 15.0, 15.50: 15.5,
     16.00: 16.0,  16.50: 16.5,  17.00: 17.0,  17.50: 17.5, 18.00: 18.0,
     18.50: 18.5,  19.00: 19.0,  19.50: 19.5,  20.00: 20.0},
  'iadc':{
    -31.50:-31.9181910417206964325487206224352,
    -31.00:-31.4170978194694896501459879800677,
    -30.50:-30.9060324277381610613701923284680,
    -30.00:-30.3916967524695671443168976111338,
    -29.50:-29.8780930151225234681078291032463,
    -29.00:-29.3673596195642829798089223913848,
    -28.50:-28.8604017167465869420084345620126,
    -28.00:-28.3573549006826048923812777502462,
    -27.50:-27.8579153415863203235858236439526,
    -27.00:-27.3615649830771836548137798672542,
    -26.50:-26.8677161642545243580570968333632,
    -26.00:-26.3757961562352143403131776722148,
    -25.50:-25.8852886093700327307942643528804,
    -25.00:-25.3957457746709884816027624765411,
    -24.50:-24.9067825736737553654620569432154,
    -24.00:-24.4180611277831367544877139152959,
    -23.50:-23.9292722039444569759325531776994,
    -23.00:-23.4401181709396624341934511903673,
    -22.50:-22.9503004725254697859782027080655,
    -22.00:-22.4595132928498202318223775364459,
    -21.50:-21.9674439986927190204824000829831,
    -21.00:-21.4737800750742557909234164981171,
    -20.50:-20.9782216082037713533736678073183,
    -20.00:-20.4804978955706786791779450140893,
    -19.50:-19.9803864598088942727827088674530,
    -19.00:-19.4777325936905398862108995672315,
    -18.50:-18.9724675509017366437092277919874,
    -18.00:-18.4646236039735853751153626944870,
    -17.50:-17.9543443995554099501532618887722,
    -17.00:-17.4418893350002832676182151772082,
    -16.50:-16.9276310416648883006018877495080,
    -16.00:-16.4120454722212869569375470746309,
    -15.50:-15.8956945344049387358609237708151,
    -15.00:-15.3792016747165050105650152545422,
    -14.50:-14.8632212754721990677353460341692,
    -14.00:-14.3484031699743539434166450519115,
    -13.50:-13.8353539862681937933075460023247,
    -13.00:-13.3245973826885943935849354602396,
    -12.50:-12.8165355209807714231828867923468,
    -12.00:-12.3114143179512591785851327585988,
    -11.50:-11.8092951071486957914657978108153,
    -11.00:-11.3100353107499209670550044393167,
    -10.50:-10.8132805514061303142625547479838,
    -10.00:-10.3184703070576198058461159234866,
     -9.50: -9.8248587114155956356853494071402,
     -9.00: -9.3315514117102118518687348114327,
     -8.50:-8.8375584961802076122694415971637,
     -8.00:-8.3418623794003181615153152961284,
     -7.50:-7.8434981666768139874079679429997,
     -7.00:-7.3416423921561619891917871427722,
     -6.50:-6.8357041217567431345969453104772,
     -6.00:-6.3254102143153971837818971835077,
     -5.50:-5.8108740252087525135493706329726,
     -5.00:-5.2926339989315875911302100575995,
     -4.50:-4.7716454134591064217829625704326,
     -4.00:-4.2492049924553647599623218411580,
     -3.50:-3.7267841742843863528378278715536,
     -3.00:-3.2057425021019527733301401895005,
     -2.50:-2.6868878598229524179430427466286,
     -2.00:-2.1698451072397135774849630251992,
     -1.50:-1.6521890467792683665493314038031,
     -1.00:-1.1282915671001498836290011240635,
     -0.50:-0.5878262377104350733247883908916,
      0.00: 0.0}
  }
